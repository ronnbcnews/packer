#version=RHEL7
# Install OS instead of upgrade
install

# Install from an installation tree on a remote server 
# Required when using a minimal ISO
url --url=http://mirror.centos.org/centos/7.1.1503/os/x86_64/
repo --name="updates" --baseurl=http://mirror.centos.org/centos/7.1.1503/updates/x86_64/
repo --name="EPEL" --baseurl=https://dl.fedoraproject.org/pub/epel/7/x86_64/

text
poweroff

# System keyboard
keyboard us

# System language
lang en_US.UTF-8

# Setup network interfaces via DHCP
network --device=eth0 --bootproto=dhcp --onboot=yes

#set root pw here (required by KS), remove pw in post
rootpw temp
firewall --enabled --service=ssh
authconfig --enableshadow --passalgo=sha512
firstboot --disabled

# SELinux configuration
# By default, selinux is enforcing
#selinux --enforcing
selinux --permissive

# Services
#services --enabled=ntpd,ntpdate

# Installation logging level
logging --level=debug

# System timezone
timezone  Etc/UTC

# System bootloader configuration
bootloader --location=mbr --driveorder=sda --append="console=hvc0 crashkernel=auto vconsole.font=latarcyrheb-sun16 LANG=en_US.UTF-8 console=tty0 rootdelay=10 selinux=0 elevator=noop divider=10"

# Clear the Master Boot Record
zerombr

# Automatically create partitions, no LVM
autopart --nolvm

# Partition clearing information
clearpart --all --initlabel

%packages --nobase
@core

-NetworkManager
-NetworkManager-libnm
-NetworkManager-team
-NetworkManager-tui
-ntp
-ntpdate
-acpid
-man
-vim-common
-vim-enhanced
-iwl6000g2b-firmware
-iwl6000g2a-firmware
-iwl5150-firmware
-iwl6000g2b-firmware
-iwl4965-firmware
-iwl135-firmware
-iwl6000-firmware
-iwl7260-firmware
-iwl1000-firmware
-iwl5000-firmware
-iwl3945-firmware
-iwl2000-firmware
-iwl6050-firmware
-iwl3160-firmware
-iwl6050-firmware
-iwl2030-firmware
-iwl105-firmware
-iwl100-firmware
-aic94xx-firmware
-ivtv-firmware
-alsa-tools-firmware
ipa-client
chrony
iputils
net-tools
parted
vim-minimal
wget
rsyslog
rsyslog-relp
redhat-lsb
nscd
sudo
#EPEL 
cloud-init
puppet

%end

%post --nochroot --log=/mnt/sysimage/var/log/ks.post01.log
#!/bin/bash
# Install sdc-vmtools guest tools
%end

%post --log=/var/log/ks.post02.log
#!/bin/bash

# Remove root password
echo "Removing root password"
passwd -d root

## Build date used for motd and product file
BUILDDATE=`date +%Y%m%d`
NAME="CentOS 7.1"

# Make sure we have the latest packages
echo "Updating packages"
/usr/bin/yum clean all
/usr/bin/yum update -y

# Clean up all yum caches
echo "Cleaning up yum caches"
/usr/bin/yum clean all

# Clean up network devices
echo "Cleaning up network devices"
/bin/rm -f /etc/udev/rules.d/70-persistent-net.rules
/bin/find /var/lib/dhclient -type f -exec rm -f '{}' +

# Remove hostname
echo "Clearing out /etc/hostname"
cat /dev/null > /etc/hostname

# Tune Linux vm.dirty_background_bytes (IMAGE-439)
# The following tuning causes dirty data to begin to be background flushed at
# 100 Mbytes, so that it writes earlier and more often to avoid a large build
# up and improving overall throughput.
# echo "Setting vm.dirty_background_bytes"
# echo "vm.dirty_background_bytes=100000000" >> /etc/sysctl.conf 

# Disable password auth. SSH logon is via ssh key only. A password is being set
# for root via the image manifest per IMAGE-459.
# echo "Disabling password auth in sshd_config"
# sed s/PasswordAuthentication\ yes/PasswordAuthentication\ no/ -i /etc/ssh/sshd_config

%end
